10 REM =============================================
20 REM  PONG - SedaiBasic
30 REM  80x50 text mode, 30 FPS
40 REM  Controls: W/S or Up/Down arrows
50 REM  Run with sbv.exe for best experience
60 REM =============================================

100 REM === INITIALIZATION ===
110 GRAPHIC 8
120 SCNCLR
130 PRINT "=== PONG ==="
140 PRINT
150 PRINT "Controls:"
160 PRINT "  W / UP    - Move paddle up"
170 PRINT "  S / DOWN  - Move paddle down"
180 PRINT "  Q         - Quit game"
190 PRINT
200 PRINT "First to 5 points wins!"
210 PRINT
220 INPUT "Press ENTER to start..."; DUMMY$

300 REM === GAME CONSTANTS ===
310 TOPWALL = 3     : REM Top playable row (border at row 2)
320 BOTWALL = 47    : REM Bottom playable row (border at row 48)
330 PADDLEH = 5     : REM Paddle height (cells 0..5 = 6 tall)
340 PADDLEX1 = 3    : REM Player paddle column
350 PADDLEX2 = 76   : REM CPU paddle column
360 WINPTS = 5      : REM Points to win

400 REM === GAME STATE ===
410 P1Y = 23       : REM Player paddle Y
420 P2Y = 23       : REM CPU paddle Y
430 BALLX = 40     : REM Ball X position
440 BALLY = 25     : REM Ball Y position
450 DX = 1        : REM Ball X direction (always +-1)
455 DY = 1        : REM Ball Y direction (always +-1)
465 P1DIR = 0      : REM Player paddle direction (-1=up, 1=down)
466 P1TMR = 0      : REM Player movement timer (frames)
470 P1SCORE = 0
480 P2SCORE = 0
490 GAMEOVER = 0

500 REM === DRAW INITIAL SCREEN ===
510 GOSUB 4000

1000 REM =============================================
1010 REM  MAIN GAME LOOP (30 FPS)
1020 REM =============================================
1030 IF GAMEOVER = 1 THEN GOTO 3000
1035 GET K$
1036 GET K2$: IF K2$ <> "" THEN K$ = K2$
1037 GET K2$: IF K2$ <> "" THEN K$ = K2$

1100 REM === ERASE OLD POSITIONS ===
1110 CHAR 0, BALLX, BALLY, " "
1115 IF BALLX = 39 THEN CHAR 0, 39, BALLY, ":"
1120 GOSUB 4600

1200 REM === PROCESS INPUT ===
1205 IF K$ = "" THEN GOTO 1280
1210 K = ASC(K$)
1220 IF K$ = "W" OR K$ = "w" OR K = 1 THEN P1DIR = -1: P1TMR = 18
1230 IF K$ = "S" OR K$ = "s" OR K = 2 THEN P1DIR = 1: P1TMR = 18
1240 IF K$ = "Q" OR K$ = "q" THEN GAMEOVER = 1: GOTO 3000
1280 REM === APPLY PADDLE MOVEMENT ===
1290 IF P1TMR <= 0 THEN GOTO 1350
1300 P1Y = P1Y + P1DIR
1310 P1TMR = P1TMR - 1
1320 IF P1Y < TOPWALL THEN P1Y = TOPWALL: P1TMR = 0
1330 IF P1Y > BOTWALL - PADDLEH THEN P1Y = BOTWALL - PADDLEH: P1TMR = 0

1350 REM === MOVE CPU PADDLE ===
1370 IF BALLY < P2Y + PADDLEH / 2 - 1 THEN IF P2Y > TOPWALL THEN P2Y = P2Y - 1
1380 IF BALLY > P2Y + PADDLEH / 2 + 1 THEN IF P2Y < BOTWALL - PADDLEH THEN P2Y = P2Y + 1

1500 REM === MOVE BALL ===
1510 NEWBX = BALLX + DX
1520 NEWBY = BALLY + DY

1600 REM === CHECK PLAYER PADDLE COLLISION ===
1610 IF NEWBX <= PADDLEX1 + 1 THEN BEGIN
1620   IF NEWBY >= P1Y AND NEWBY <= P1Y + PADDLEH THEN BEGIN
1630     DX = 1
1640     NEWBX = PADDLEX1 + 2
1650     RELPOS = NEWBY - P1Y
1654     IF RELPOS <= 1 THEN DY = -1
1664     IF RELPOS >= 4 THEN DY = 1
1680   BEND
1690 BEND

1700 REM === CHECK CPU PADDLE COLLISION ===
1710 IF NEWBX >= PADDLEX2 - 1 THEN BEGIN
1720   IF NEWBY >= P2Y AND NEWBY <= P2Y + PADDLEH THEN BEGIN
1730     DX = -1
1740     NEWBX = PADDLEX2 - 2
1750     RELPOS = NEWBY - P2Y
1754     IF RELPOS <= 1 THEN DY = -1
1764     IF RELPOS >= 4 THEN DY = 1
1780   BEND
1790 BEND

1800 REM === CHECK TOP/BOTTOM WALL BOUNCE ===
1805 NEWBY = BALLY + DY
1810 IF NEWBY < TOPWALL THEN DY = 1
1815 IF NEWBY > BOTWALL THEN DY = -1
1820 NEWBY = BALLY + DY
1825 IF NEWBY < TOPWALL THEN NEWBY = TOPWALL
1830 IF NEWBY > BOTWALL THEN NEWBY = BOTWALL

1900 REM === CHECK SCORE ===
1910 IF NEWBX < 1 THEN BEGIN
1920   P2SCORE = P2SCORE + 1
1930   GOSUB 5000
1940   GOTO 2100
1950 BEND
1960 IF NEWBX > 78 THEN BEGIN
1970   P1SCORE = P1SCORE + 1
1980   GOSUB 5000
1990   GOTO 2100
2000 BEND

2010 REM === UPDATE BALL POSITION ===
2020 BALLX = NEWBX
2030 BALLY = NEWBY

2100 REM === DRAW NEW POSITIONS ===
2110 GOSUB 4700
2120 CHAR 0, BALLX, BALLY, "O"

2200 REM === UPDATE SCORE DISPLAY ===
2210 CHAR 0, 30, 0, STR$(P1SCORE)
2220 CHAR 0, 50, 0, STR$(P2SCORE)

2300 REM === CHECK WIN CONDITION ===
2310 IF P1SCORE >= WINPTS THEN WINNER$ = "PLAYER 1": GAMEOVER = 1
2320 IF P2SCORE >= WINPTS THEN WINNER$ = "CPU": GAMEOVER = 1

2500 REM === FRAME SYNC AND LOOP ===
2510 FRAME 30
2520 GOTO 1030

3000 REM =============================================
3010 REM  GAME OVER
3020 REM =============================================
3030 CHAR 0, 31, 22, "*** GAME OVER ***"
3040 IF P1SCORE >= WINPTS OR P2SCORE >= WINPTS THEN BEGIN
3050   CHAR 0, 35, 24, WINNER$
3060   CHAR 0, 35 + LEN(WINNER$), 24, " WINS!"
3070 BEND
3080 CHAR 0, 33, 26, "Final: "
3090 CHAR 0, 40, 26, STR$(P1SCORE)
3100 CHAR 0, 42, 26, "-"
3110 CHAR 0, 44, 26, STR$(P2SCORE)
3120 CHAR 0, 31, 28, "Press any key..."
3130 GETKEY K$
3140 SCNCLR
3150 PRINT "Thanks for playing PONG!"
3160 PRINT
3170 INPUT "Play again? (Y/N): "; PA$
3180 IF PA$ = "Y" OR PA$ = "y" THEN RUN
3190 END

4000 REM =============================================
4010 REM  DRAW GAME FIELD
4020 REM =============================================
4030 SCNCLR
4040 REM Score header on row 0
4050 CHAR 0, 20, 0, "PLAYER:"
4060 CHAR 0, 30, 0, "0"
4070 CHAR 0, 42, 0, "CPU:"
4080 CHAR 0, 50, 0, "0"
4090 REM Top border (row 2, below score)
4100 FOR X = 0 TO 79
4110 CHAR 0, X, 2, "="
4120 NEXT X
4130 REM Bottom border (row 48)
4140 FOR X = 0 TO 79
4150 CHAR 0, X, 48, "="
4160 NEXT X
4170 REM Center line
4180 FOR Y = TOPWALL TO BOTWALL
4190 CHAR 0, 39, Y, ":"
4200 NEXT Y
4210 REM Draw paddles
4220 GOSUB 4700
4230 REM Draw ball
4240 CHAR 0, BALLX, BALLY, "O"
4250 RETURN

4600 REM === ERASE PADDLES ===
4610 FOR I = 0 TO PADDLEH
4620 CHAR 0, PADDLEX1, P1Y + I, " "
4630 CHAR 0, PADDLEX2, P2Y + I, " "
4640 NEXT I
4650 RETURN

4700 REM === DRAW PADDLES ===
4710 FOR I = 0 TO PADDLEH
4720 CHAR 0, PADDLEX1, P1Y + I, "|"
4730 CHAR 0, PADDLEX2, P2Y + I, "|"
4740 NEXT I
4750 RETURN

5000 REM =============================================
5010 REM  RESET BALL TO CENTER
5020 REM =============================================
5030 BALLX = 40
5040 BALLY = 25
5046 P1TMR = 0
5050 REM Randomize direction
5060 IF RND(1) > 0.5 THEN DX = 1 ELSE DX = -1
5065 IF RND(1) > 0.5 THEN DY = 1 ELSE DY = -1
5080 REM Draw ball at center, then pause
5090 CHAR 0, BALLX, BALLY, "O"
5100 FOR I = 1 TO 30
5110 FRAME 30
5120 NEXT I
5122 GET K$
5124 IF K$ <> "" THEN GOTO 5122
5130 RETURN
